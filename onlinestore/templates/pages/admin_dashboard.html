{% extends "base.html" %}
{% load static %}

{% block title %}Панель управления{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="container" style="padding: 40px 5%;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 style="font-family: 'Playfair Display'; font-size: 2.5rem; margin: 0;">Панель управления</h1>
            <a href="{% url 'export_orders' %}" class="btn-main">
                <i class="bi bi-download" style="margin-right: 8px;"></i>Экспорт заказов
            </a>
        </div>

        <!-- Статистика -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
            <div style="background: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: var(--shadow-sm);">
                <i class="bi bi-people" style="font-size: 2.5rem; color: var(--accent-primary);"></i>
                <h3 style="margin: 15px 0 5px;">{{ total_users }}</h3>
                <p style="color: var(--text-secondary);">Пользователей</p>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: var(--shadow-sm);">
                <i class="bi bi-box" style="font-size: 2.5rem; color: var(--accent-primary);"></i>
                <h3 style="margin: 15px 0 5px;">{{ total_products }}</h3>
                <p style="color: var(--text-secondary);">Товаров</p>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: var(--shadow-sm);">
                <i class="bi bi-cart" style="font-size: 2.5rem; color: var(--accent-primary);"></i>
                <h3 style="margin: 15px 0 5px;">{{ total_orders }}</h3>
                <p style="color: var(--text-secondary);">Заказов</p>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: var(--shadow-sm);">
                <i class="bi bi-currency-ruble" style="font-size: 2.5rem; color: var(--accent-primary);"></i>
                <h3 style="margin: 15px 0 5px;">{{ total_revenue }} ₽</h3>
                <p style="color: var(--text-secondary);">Выручка</p>
            </div>
        </div>

        <!-- Статистика за 30 дней -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
            <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: var(--shadow-sm);">
                <h3 style="margin-bottom: 20px;">За последние 30 дней</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span>Заказов:</span>
                    <span style="font-weight: 600;">{{ recent_orders }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Выручка:</span>
                    <span style="font-weight: 600; color: var(--accent-primary);">{{ recent_revenue }} ₽</span>
                </div>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: var(--shadow-sm);">
                <h3 style="margin-bottom: 20px;">Статусы заказов</h3>
                {% for status in order_statuses %}
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>{{ status.get_name_display }}</span>
                    <span style="font-weight: 600;">{{ status.count }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Топ товаров -->
        <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: var(--shadow-sm);">
            <h3 style="margin-bottom: 20px;">Топ продаж</h3>
            <div style="display: grid; gap: 15px;">
                {% for product in top_products %}
                <div style="display: flex; align-items: center; gap: 15px; padding: 10px; border-bottom: 1px solid var(--border-color);">
                    {% with main_image=product.get_main_image %}
                        {% if main_image %}
                            <img src="{{ main_image.image.url }}" alt="" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                        {% else %}
                            <div style="width: 50px; height: 50px; background: var(--border-color); border-radius: 8px;"></div>
                        {% endif %}
                    {% endwith %}
                    <div style="flex: 1;">
                        <p style="margin: 0; font-weight: 500;">{{ product.name }}</p>
                        <p style="margin: 5px 0 0; color: var(--text-secondary); font-size: 0.9rem;">Продано: {{ product.order_count }}</p>
                    </div>
                    <span style="font-weight: 600; color: var(--accent-primary);">{{ product.price }} ₽</span>
                </div>
                {% empty %}
                <p style="color: var(--text-secondary); text-align: center;">Нет данных о продажах</p>
                {% endfor %}
            </div>
        </div>

        <!-- Быстрые ссылки -->
        <div style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px;">Быстрые ссылки</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="{% url 'manage_products' %}" class="btn-main">Управление товарами</a>
                <a href="{% url 'manage_orders' %}" class="btn-outline">Управление заказами</a>
                <a href="{% url 'moderate_reviews' %}" class="btn-outline">Модерация отзывов</a>
                <a href="/admin/" class="btn-outline">Django Admin</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}